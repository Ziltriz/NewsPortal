# NewsPortal

## Задание
Тестовое задание на разработчика Python
ООО «Центр цифрового развития»

Разработать Django-приложение с функционалом:
1. CRUD (подсказка: DRF) Новостей с данными:
• Заголовок новости
• Главное изображение
• Превью-изображение (автоматически генерировать из главного изображения путём
уменьшения до 200px по наименьшей стороне)
• Текст новости
• Дата публикации
• Автор новости
2. 3. Просмотр и редактирование Новостей с rich-текстом (подсказка: summernote) в админке.
Выполнение периодической задачи (подсказка: celery) на отправку email о Новостях,
опубликованных сегодня, с настройками (подсказка: constance):
• Список адресатов
• Тема сообщения
• Текст сообщения
• Время отправки
4. Импорт Примечательных мест из xlsx-файла с данными:
• Название места
• Гео-координаты места (точка)
• Рейтинг (от 0 до 25)
5. Просмотр и редактирование Примечательных мест в админке, координаты получать с
помощью виджета карты.
6. Выполнение периодической задачи (подсказка: celery) на получение Сводки погоды в
Примечательном месте:
• Периодичность выполнения задачи должна редактироваться из админки, по умолчанию -
раз в час
• Провайдера погоды выбрать самостоятельно (можно реализовать сервис в другом
приложении)
• Данные Сводки погоды:
• Температура по шкале Цельсия
• Влажность воздуха, в %
• Атмосферное давление, в мм ртутного столба
• Направление ветра
• Скорость ветра, в м/с
• Данные Сводки погоды должны быть реалистичными и разными (но не обязательно
настоящими)
• Данные Сводки погоды должны сохраняться без возможности редактирования
7. Просмотр Сводки погоды в админке с фильтром по Примечательному месту и дате
снятия показаний.
8. Экспорт Сводки погоды в xlsx-файл (подсказка: xlsxWriter) с фильтром по
Примечательному месту и дате снятия показаний.
Дополнительные баллы можно набрать за:
• Разворачивание приложения в docker
• Адекватную историю коммитов
• Readme с описанием реализованного функционала и инструкциями по разворачиванию
локально (и в docker)

## Описание проекта

NewsPortal — это веб-приложение на Django, которое предоставляет функционал для управления новостями и примечательными местами. Проект включает следующие ключевые возможности:

1. **CRUD для новостей (Django REST Framework)**:
   - Создание, просмотр, редактирование и удаление новостей.
   - Автоматическая генерация превью-изображений для новостей.
   - Rich-текстовый редактор Summernote для создания новостей в админке.

2. **Периодическая отправка email о новостях**:
   - Отправка email всем указанным получателям с новостями, опубликованными сегодня.
   - Периодичность и параметры рассылки настраиваются через Constance в админке.

3. **Импорт примечательных мест из XLSX-файла**:
   - Возможность импорта данных о местах (название, координаты, рейтинг) из XLSX-файла.
   - Пример файла для импорта: `test.xlsx`.

4. **Просмотр и редактирование примечательных мест**:
   - Администратор может просматривать и редактировать места через админку.
   - Координаты выбираются через интерактивную карту (Leaflet).

5. **Сводка погоды для примечательных мест**:
   - Автоматическое обновление данных о погоде для каждого места раз в час.
   - Хранение данных о температуре, влажности, давлении, направлении и скорости ветра.
   - Просмотр сводок погоды в админке с фильтрами по месту и дате.

6. **Экспорт сводок погоды в XLSX**:
   - Возможность экспорта данных о погоде в файл XLSX через API.
   - Фильтрация экспортируемых данных по месту и дате.

---

## Требования

- Python 3.10+
- Docker и Docker Compose
- PostgreSQL (используется через Docker)
- Redis (используется через Docker для Celery)

---

## Установка через Docker

### 1. Клонирование репозитория

Клонируйте репозиторий с проектом:

```bash
git clone https://github.com/your-repo/newsportal.git
cd newsportal
```

---

### 2. Запуск проекта

#### a) Сборка контейнеров

Выполните сборку контейнеров:

```bash
docker-compose up --build
```

Это создаст и запустит следующие сервисы:
- `web`: Основное Django-приложение.
- `db`: PostgreSQL база данных.
- `redis`: Redis для Celery.
- `celery_worker`: Рабочий процесс Celery.
- `celery_beat`: Планировщик периодических задач Celery.

---

#### b) Применение миграций

Примените миграции к базе данных:

```bash
docker-compose exec web python manage.py migrate
```

---

#### c) Создание суперпользователя

Создайте администратора для доступа к админке Django:

```bash
docker-compose exec web python manage.py createsuperuser
```

Введите логин, email и пароль для создания суперпользователя.

---

#### d) Запуск сервера

Проект автоматически запустится на `http://localhost:8000`. Вы можете открыть его в браузере.

---

## Настройка проекта

### 1. Доступ к админке

Откройте админку по адресу `http://localhost:8000/admin/` и войдите с учетными данными суперпользователя.

---

### 2. Настройка Constance

В разделе **Constance** админки вы можете настроить следующие параметры:
- `EMAIL_RECIPIENTS`: Список получателей email (через запятую).
- `EMAIL_SUBJECT`: Тема сообщения для рассылки новостей.
- `EMAIL_MESSAGE`: Текст сообщения для рассылки новостей.
- `HOUR`: Час отправки ежедневной рассылки (0-23).
- `MINUTES`: Минута отправки ежедневной рассылки (0-59).

---

### 3. Импорт примечательных мест

Для импорта данных о примечательных местах используйте эндпоинт API:

```
POST http://localhost:8000/api/places/import-places/
```

Формат запроса:
- Передайте XLSX-файл через поле `file`.

Пример структуры файла (`test.xlsx`):

| Название места      | Широта (Lat) | Долгота (Lon) | Рейтинг |
|---------------------|--------------|---------------|---------|
| Статуя Свободы      | 40.6892      | -74.0445      | 20      |
| Колизей            | 41.8902      | 12.4922       | 22      |
| Эйфелева башня      | 48.8584      | 2.2945        | 25      |

---

### 4. Экспорт сводок погоды

Для экспорта данных о погоде в XLSX-файл используйте следующий эндпоинт:

```
GET http://localhost:8000/api/places/export-weather/
```

Параметры запроса:
- `place`: ID примечательного места (необязательный параметр).
- `date`: Дата снятия показаний (формат YYYY-MM-DD, необязательный параметр).

Пример запроса:
```
GET http://localhost:8000/api/places/export-weather/?place=1&date=2023-10-16
```

---

### 5. Периодические задачи

Проект использует Celery для выполнения следующих периодических задач:
- **Отправка новостей**: Ежедневная рассылка новостей всем указанным получателям.
- **Обновление погоды**: Ежечасное обновление данных о погоде для примечательных мест.

Настройки времени выполнения задач можно изменять через админку Django-celery-beat.

---

## Дополнительные команды

### 1. Обновление статики

Если вы добавили новые статические файлы (например, CSS или JS), соберите их:

```bash
docker-compose exec web python manage.py collectstatic
```

---

### 2. Проверка логов

Просмотр логов всех контейнеров:

```bash
docker-compose logs
```

Логи конкретного контейнера (например, Celery Worker):

```bash
docker-compose logs celery_worker
```

---

### 3. Вход в контейнер

Для выполнения команд внутри контейнера используйте:

```bash
docker-compose exec web bash
```

---

## Зависимости

Основные зависимости проекта:

- Django==4.1.*
- djangorestframework==3.14.*
- Pillow==9.5.*
- celery==5.2.*
- redis==4.3.*
- django-constance==4.3.*
- django-leaflet==0.28.*
- openpyxl==3.0.*
- xlsxwriter==3.0.*
- django-summernote==0.8.*
- psycopg2-binary==2.9.*
- django-celery-beat==2.7.0
- django-filter==23.1


---

## Структура проекта

```
newsportal/
├── newsportal/                # Настройки проекта
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── news/                      # Приложение "Новости"
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── serializers.py
│   ├── tasks.py
│   ├── views.py
│   ├── urls.py
│   └── migrations/
├── places/                    # Приложение "Примечательные места"
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── tasks.py
│   ├── views.py
│   ├── urls.py
│   └── migrations/
├── media/                     # Папка для медиафайлов
├── templates/                 # Папка для шаблонов
├── requirements.txt           # Файл зависимостей
├── Dockerfile                 # Конфигурация Docker
├── docker-compose.yml         # Конфигурация Docker Compose
└── manage.py                  # Управляющий файл Django
```

---

## Инструкция по работе с проектом

### 1. CRUD для новостей

- **Создание новости**:
  - Через админку Django: `/admin/`.
  - Через API: `POST /api/news/`.

- **Просмотр новостей**:
  - Все новости: `GET /api/news/`.
  - Конкретная новость: `GET /api/news/{id}/`.

- **Редактирование новости**:
  - Через API: `PUT /api/news/{id}/`.

- **Удаление новости**:
  - Через API: `DELETE /api/news/{id}/`.

---

### 2. Импорт примечательных мест

Для импорта данных о примечательных местах из XLSX-файла используйте:

```
POST /api/places/import-places/
```

Формат файла:
| Название места      | Широта (Lat) | Долгота (Lon) | Рейтинг |
|---------------------|--------------|---------------|---------|
| Статуя Свободы      | 40.6892      | -74.0445      | 20      |
| Колизей            | 41.8902      | 12.4922       | 22      |
| Эйфелева башня      | 48.8584      | 2.2945        | 25      |

---

### 3. Экспорт сводок погоды

Для экспорта данных о погоде в XLSX-файл используйте:

```
GET /api/places/export-weather/
```

Параметры:
- `place`: ID примечательного места.
- `date`: Дата снятия показаний (формат YYYY-MM-DD).

---

### Что содержит этот README

1. **Описание проекта**: Краткое описание основных функций.
2. **Требования**: Необходимые компоненты для работы проекта.
3. **Инструкция по установке через Docker**:
   - Сборка контейнеров.
   - Применение миграций.
   - Создание суперпользователя.
4. **Инструкция по использованию**:
   - CRUD для новостей.
   - Импорт примечательных мест.
   - Экспорт данных о погоде.
